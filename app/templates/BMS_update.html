<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BMS - Update Server</title>

    <!-- CSS -->
    <link rel="stylesheet" href="/static/css/BMS_update.css">
</head>
<body>

<h2>âš™ï¸ BMS Server Update Panel</h2>

<!-- Box Notifikasi -->
<div id="notifyBox"></div>


<!-- ======================================================
    ğŸ”„ UPDATE SYSTEM
====================================================== -->
<div class="section-title">ğŸ”„ Jalankan Update Otomatis</div>

<button class="btn" onclick="runUpdate()">Jalankan Pembaruan</button>



<!-- ======================================================
    ğŸ” RESTART SERVER (MANUAL)
====================================================== -->
<button class="btn warn" onclick="restartServer()">Restart Server</button>



<!-- ======================================================
    ğŸ“œ LOG SYSTEM
====================================================== -->
<div class="container">
    <div class="section-title">ğŸ“œ Log Sistem</div>

    <button class="btn" onclick="loadLog()">Reload Log</button>
    <button class="btn" onclick="clearLog()">Clear Log</button>

    <div id="logBox" class="log-box">Log belum dimuat...</div>
</div>


<!-- ======================================================
    JAVASCRIPT
====================================================== -->
<script>
/* -------------------------------
    ğŸ”” Notifikasi
--------------------------------*/
function notify(msg, type="info") {
    const box = document.getElementById("notifyBox");
    box.innerHTML = msg;
    box.className = "notify " + type;
    setTimeout(() => { box.innerHTML = ""; box.className = "" }, 3500);
}



/* -------------------------------
    ğŸ”„ Jalankan Update
--------------------------------*/
function runUpdate() {
    notify("Menjalankan update...", "info");

    fetch("/update/do")
        .then(res => res.json())
        .then(data => {
            if (data.status === "ok") {
                notify("âœ” Update berhasil!", "success");
                loadLog();
            } else {
                notify("âŒ Gagal update: " + (data.error || data.msg), "error");
            }
        })
        .catch(err => notify("âŒ Error: " + err, "error"));
}



/* -------------------------------
    ğŸ” Restart Server
--------------------------------*/
function restartServer() {
    alert("âš  Restart server dilakukan secara manual di Termux:\n\n$ pkill -f flask\n$ python run.py");
}



/* -------------------------------
    ğŸ“œ Load Log
--------------------------------*/
function loadLog() {
    fetch("/update/logs")
        .then(res => res.json())
        .then(data => {
            document.getElementById("logBox").innerText = data.log || "Log kosong.";
        });
}



/* -------------------------------
    ğŸ§¹ Clear Log
--------------------------------*/
function clearLog() {
    fetch("/logger/clear")
        .then(res => res.json())
        .then(data => {
            notify("âœ” Log berhasil dibersihkan!", "success");
            document.getElementById("logBox").innerText = "Log kosong.";
        })
        .catch(err => notify("âŒ Error: " + err, "error"));
}
</script>

</body>
</html>